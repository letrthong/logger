<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<script  type="text/javascript" src="js/FileSaver.js" ></script>
	<script  type="text/javascript" src="js/controller.js" ></script>
	<script  type="text/javascript" src="js/controller.js" ></script>
	<script  type="text/javascript" src="js/model.js" ></script>
	<script  type="text/javascript" src="js/view.js" ></script>
	<script  type="text/javascript" src="js/utils.js" ></script>
	<script  type="text/javascript" src="js/info.js" ></script>
	<script  type="text/javascript" src="js/stype.js" ></script>

	<link rel="stylesheet" type="text/css" href="css/logger.css">
</head>
<body>
	<div class="parent" >
		<div class="left">
			<div class="div1"  			id="ID_View_Div_Logger_001" >
				<pre 					id="ID_View_Txt_Logger_001" ></pre>  
		 	</div>
			<div class="div3" 			id="ID_View_Div_Search_001" >
				<pre  					id="ID_View_Txt_Search_001" ></pre>
			</div>
		</div>
		<div class="right" >
			<div class="div2" 			id="ID-Configuration_Div_001">
				<select   				id="ID_Configuration_SL_App_001"  ></select>  <br>
				<input type="checkbox" 	id="ID_Configuration_CB_Info_001" > info 
				<input type="checkbox" 	id="ID_Configuration_CB_Warn_001" > Warn
				<input type="text" 		id="ID_Configuration_TXT_Search_001" onkeypress="handleKeyPress(event)" >  
				<button type="button"	id="ID_Configuration_BT_Search_001" > Search </button>
				<input type="text"		id="ID_Configuration_TXT_Filter_001" > 
				<input type="text" 		id="ID_Configuration_TXT_CMD_001" > 
			</div>	
			<div class="div0"  			id="ID-Controller-div-001" >
				<button type="button" 	id="ID_Controller_BT_Start_001" > Start </button>
				<button type="button" 	id="ID_Controller_BT_Stop_001"  >  Stop </button>
				<button type="button" 	id="ID_Controller_BT_Save_001" 	> Save </button>
				<button type="button" 	id="ID_Controller_BT_Clear_001" > Clear </button>
			</div>
		</div>
	</div>
	<script>
	    
	    var myscroll = new mouseScroll("ID_View_Div_Logger_001");
	    var myview   = new viewTextOutput("ID_View_Txt_Logger_001");
	    var mymodel  = new ModelText("/api");
	    
	    var myresults  = new viewTextOutput("ID_View_Txt_Search_001");
        var searchview = new viewTextInput("ID_Configuration_TXT_Search_001")

	    var myinfo   = new Info();
	    var mydiv1   = new StypeTxt("ID_View_Div_Logger_001");
	    var mydiv3   = new StypeTxt("ID_View_Div_Search_001");
	   	mydiv1.setHight( (myinfo.getHeighOfScreen()*0.70) );
	   	mydiv3.setHight( (myinfo.getHeighOfScreen()*0.15) );
	     
        var buton1 = new registerEvent("ID_Controller_BT_Start_001");
        buton1.ClickMouse(clickButtonStart);


        var buton2 = new registerEvent("ID_Controller_BT_Stop_001");
        buton2.ClickMouse(clickButtonStop);


        var buton3 = new registerEvent("ID_Controller_BT_Save_001");
        buton3.ClickMouse(clickButtonSave);

        var buton4 = new registerEvent("ID_Controller_BT_Clear_001");
        buton4.ClickMouse(clickButtonClear);


        var buton5 = new registerEvent("ID_Configuration_BT_Search_001");
        buton5.ClickMouse(clickButtonSearch);
        

        var div1 = new registerEvent("ID_View_Div_Logger_001");
        div1.mouseOver(CallMouseMove);
        div1.mouseOut(CallMouseOut)
  

		var txt = "";
		var flag = 1;
		var num = 0;
		setInterval(myTimer, 2);
		setInterval(refreshUI,100);
		
		function refreshUI(){
			if(flag == 0){
				 myscroll.setscrollTop(num); 
			}

			myview.updateTxt(txt);
		}

		function myTimer() {
		    if (flag != 0) {
		        return;
		    }

		    txt += mymodel.httpRequest(num);
		    num = num + 1;
		}

		function clickButtonStart() {
		    flag = 0;
		}

		function clickButtonStop() {
		    flag = 1;
		}

		function clickButtonClear() {
		    myview.clearTxt();
		    txt = "";
		    num = 0;
		}
		

		function clickButtonSearch(){
            var key = searchview.getTxt() 
			 if(txt == "" ||key  == "" ){
			 	myresults.updateTxt("Not Found");
			 	return;
			 }
	 
	         myresults.updateTxt("search ....\n");
			 
			 
			 if( key != ""){
			 	var array = txt.split("\n");
			 	var result = "";

			 	for(i =0 ; i< array.length ; i++){
		 			if(array[i].toUpperCase().indexOf( key.toUpperCase()) >= 0){
		 				result =result + array[i]  + "\n";
		 			}
			 	}
			 	myresults.updateTxt(result);
			 }
		}
	  
	    function handleKeyPress(e){
		 var key=e.keyCode || e.which;
		  if (key==13){
		     clickButtonSearch();
		  }
		}


		function clickButtonSave(){
			var text =txt;
			txt = "";
			num = 0;
			
			var d = new Date();
			var filename = d.toLocaleTimeString() + "-" + d.toLocaleDateString()   + "-Logger"
			var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
			saveAs(blob, filename+".txt");
		}
		
		
		function CallMouseMove() {
		    myscroll.stopScroll();
		}

		function CallMouseOut() {
		    myscroll.startScroll();
		}
		
	</script>
</body>
</html>
